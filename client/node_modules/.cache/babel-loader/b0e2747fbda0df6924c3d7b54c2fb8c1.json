{"ast":null,"code":"import _objectSpread from\"I:/Facu/progra CS/workspace/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"I:/Facu/progra CS/workspace/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from'react';import{useForm}from'react-hook-form';import{crearPedido,updatePedido,borrarPedido}from'../../_actions/pedidos';import{updateProducto}from'../../_actions/productos';import{useSelector}from'react-redux';import PedidoItem from'../pedidos/PedidoItem';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";export default function FormPedido(_ref){var getId=_ref.getId,setId=_ref.setId,dispatch=_ref.dispatch;var _useForm=useForm(),register=_useForm.register,handleSubmit=_useForm.handleSubmit,reset=_useForm.reset,setValue=_useForm.setValue;var pedido=useSelector(function(state){return state.pedidos.find(function(pedido){return pedido._id===getId?pedido:null;});});var _useState=useState(0),_useState2=_slicedToArray(_useState,2),dnivalue=_useState2[0],setDnivalue=_useState2[1];useEffect(function(){if(getId!==0){var keys=Object.keys(pedido);keys.forEach(function(key){return setValue(key,pedido[key]);});}},[getId,pedido,setValue]);var stock=true;var onSubmit=function onSubmit(data){stock=true;data.productos=pedidoItems;data.productos.forEach(function(p){productos.find(function(producto){if(p.producto===producto._id){if(producto.stock-p.cantidad<0){cancelar(producto);}}});});if(stock){if(getId===0){if(data.cliente){dispatch(crearPedido(data));var ps=[];data.productos.forEach(function(p){productos.find(function(producto){if(p.producto===producto._id&&p.cantidad>0){producto.stock=producto.stock-p.cantidad;dispatch(updateProducto(producto._id,producto));}});});reset();}}else{dispatch(updatePedido(getId,data));reset();setId(0);}}};var cancelar=function cancelar(producto){stock=false;alert(\"No hay suficiente \"+producto.nombre);};var borrar=function borrar(id){dispatch(borrarPedido(id));reset();setId(0);};var clientes=useSelector(function(state){return state.clientes;});var productos=useSelector(function(state){return state.productos;});var pedidoItems=useSelector(function(state){return state.productos.map(function(producto){return{producto:producto._id,cantidad:\"0\"};});});var _actualizarPedido=function actualizarPedido(e,index){pedidoItems[index].cantidad=e.target.value;};return/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit(onSubmit),children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"productos\",children:\"Seleccione Cliente:\"}),/*#__PURE__*/_jsxs(\"select\",_objectSpread(_objectSpread({},register('cliente')),{},{className:\"smallLogindrop\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\"}),clientes.map(function(cliente){return/*#__PURE__*/_jsx(\"option\",{value:cliente._id,children:cliente.nickname},cliente._id);})]}))]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"productos\",children:[productos.map(function(producto,i){return/*#__PURE__*/_jsx(PedidoItem,{producto:producto,actualizarPedido:function actualizarPedido(e){_actualizarPedido(e,i);}},producto._id);}),/*#__PURE__*/_jsx(\"input\",_objectSpread({type:\"hidden\",name:\"estado\",value:\"NUEVO\"},register('estado')))]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"Guardar\"})]})});}","map":{"version":3,"names":["React","useState","useEffect","useForm","crearPedido","updatePedido","borrarPedido","updateProducto","useSelector","PedidoItem","FormPedido","getId","setId","dispatch","register","handleSubmit","reset","setValue","pedido","state","pedidos","find","_id","dnivalue","setDnivalue","keys","Object","forEach","key","stock","onSubmit","data","productos","pedidoItems","p","producto","cantidad","cancelar","cliente","ps","alert","nombre","borrar","id","clientes","map","actualizarPedido","e","index","target","value","nickname","i"],"sources":["I:/Facu/progra CS/workspace/client/src/components/form/FormPedido.js"],"sourcesContent":["import React, { useState, useEffect } from 'react'\r\nimport { useForm } from 'react-hook-form';\r\nimport { crearPedido, updatePedido, borrarPedido } from '../../_actions/pedidos';\r\nimport { updateProducto } from '../../_actions/productos';\r\nimport { useSelector } from 'react-redux';\r\nimport PedidoItem from '../pedidos/PedidoItem';\r\n\r\nexport default function FormPedido({ getId, setId, dispatch }) {\r\n\tconst { register, handleSubmit, reset, setValue } = useForm();\r\n\tconst pedido = useSelector(state => state.pedidos.find((pedido) => pedido._id === getId ? pedido : null));\r\n\tconst [dnivalue, setDnivalue] = useState(0);\r\n\tuseEffect(() => {\r\n\t\tif (getId !== 0) {\r\n\t\t\tlet keys = Object.keys(pedido);\r\n\t\t\tkeys.forEach((key) => setValue(key, pedido[key]))\r\n\t\t}\r\n\t}, [getId, pedido, setValue])\r\n\tlet stock = true;\r\n\tconst onSubmit = (data) => {\r\n\t\tstock = true;\r\n\t\tdata.productos = pedidoItems;\r\n\t\tdata.productos.forEach(p => { productos.find(producto => { if (p.producto === producto._id) { if (producto.stock - p.cantidad < 0) { cancelar(producto); } } }) })\r\n\t\tif (stock) {\r\n\t\t\tif (getId === 0) {\r\n\t\t\t\tif (data.cliente) {\r\n\t\t\t\t\tdispatch(crearPedido(data))\r\n\t\t\t\t\tconst ps = [];\r\n\t\t\t\t\tdata.productos.forEach(p => { productos.find(producto => { if (p.producto === producto._id && p.cantidad > 0) { producto.stock=producto.stock-p.cantidad; dispatch(updateProducto(producto._id, producto)) } }) })\r\n\t\t\t\t\treset()\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tdispatch(updatePedido(getId, data))\r\n\t\t\t\treset()\r\n\t\t\t\tsetId(0)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tconst cancelar = (producto) => {\r\n\t\tstock = false;\r\n\t\talert(\"No hay suficiente \" + producto.nombre);\r\n\t}\r\n\tconst borrar = (id) => {\r\n\t\tdispatch(borrarPedido(id));\r\n\t\treset()\r\n\t\tsetId(0)\r\n\t}\r\n\tconst clientes = useSelector(state => state.clientes)\r\n\tconst productos = useSelector(state => state.productos)\r\n\tconst pedidoItems = useSelector(state => state.productos.map(producto => {return {producto:producto._id, cantidad:\"0\"}}));\r\n\tconst actualizarPedido = (e, index) => {\r\n\t\tpedidoItems[index].cantidad = e.target.value;\r\n\t};\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<form onSubmit={handleSubmit(onSubmit)} >\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<div className=\"productos\">Seleccione Cliente:</div>\r\n\t\t\t\t\t<select {...register('cliente')} className=\"smallLogindrop\">\r\n\t\t\t\t\t\t<option value=\"\" />\r\n\t\t\t\t\t\t{clientes.map(cliente => {\r\n\t\t\t\t\t\t\treturn <option key={cliente._id} value={cliente._id} >{cliente.nickname}</option>;\r\n\t\t\t\t\t\t})}\r\n\t\t\t\t\t</select>\r\n\t\t\t\t</div>\r\n\t\t\t\t<br />\r\n\t\t\t\t<div className=\"productos\">\r\n\t\t\t\t\t{productos.map((producto, i) => {\r\n\t\t\t\t\t\treturn <PedidoItem producto={producto} key={producto._id} actualizarPedido={e => {actualizarPedido(e, i);}}/>;\r\n\t\t\t\t\t})}\r\n\t\t\t\t\t<input type=\"hidden\" name=\"estado\" value=\"NUEVO\" {...register('estado')} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<br />\r\n\t\t\t\t<button type=\"submit\">Guardar</button>\r\n\t\t\t</form>\r\n\t\t</>\r\n\t)\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module"}